<div class="row">
    <div class="col-12 col-lg-6">
        <h2><i class="fa fa-users"></i> {{ _("Accounts") }} <small class="text-muted">{{ domain.name }}</small></h2>
    </div>
    <div class="col-12 col-lg-6">
        {% ifequal userType 0 %}
        <a class="btn btn-outline-danger float-right ml-1" href="/domain/{{ domain.id }}/remove" role="button"><i class="fa fa-trash"></i> {{ _("Delete") }}</a>
        {% endifequal %}
        <a class="btn btn-outline-info float-right ml-1" href="/domain/{{ domain.id }}/edit" role="button"><i class="fa fa-edit"></i> {{ _("Edit") }}</a>
        <a class="btn btn-outline-primary float-right" href="/domain/{{ domain.id }}/add_account" role="button"><i class="fa fa-plus"></i> {{ _("Add account") }}</a>
    </div>
</div>

{% if pagination.accounts.size %}
<div class="row mt-1">
    <div class="col">
        <table id="accountsTable" class="table table-responsive">
            <thead>
                <tr>
                    <th>{{ _("Actions") }}</th>
                    <th>{{ _("Username") }}</th>
                    <th>{{ _("Email addresses") }}</th>
                    <th>{{ _("Forwards") }}</th>
                    <th>{{ _("Quota used") }}</th>
                    <th>{{ _("Services") }}</th>
                </tr>
            </thead>
            <tbody>
                {% for account in pagination.accounts %}
                <tr id="account-{{ domain.id }}-{{ account.id }}" class="account-row" data-domainid="{{ domain.id }}" data-accountid="{{ account.id }}" data-username="{{ account.username }}">
                    <td>
                        <div class="btn-group">
                            <a href="/account/{{ domain.id }}/{{ account.id }}/addresses" title='{{ _("Edit email addresses") }}' class="btn btn-sm btn-secondary" role="button"><i class="fa fa-envelope-o fa-fw"></i></a>
                            <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="sr-only">{{ _("Toggle dropdown") }}</span>
                            </button>
                            <div class="dropdown-menu">
                                <a href="/account/{{ domain.id }}/{{ account.id }}/edit" class="dropdown-item"><i class="fa fa-edit fa-fw"></i> {{ _("Edit account") }}</a>
                                <a href="/account/{{ domain.id }}/{{ account.id }}/forwards" class="dropdown-item"><i class="fa fa-mail-forward fa-fw"></i> {{ _("Forwards") }}</a>
                                <a href="#" class="dropdown-item check-account-btn" data-toggle="modal" data-target="#checkAccountModal"><i class="fa fa-stethoscope fa-fw"></i> {{ _("Check account") }}</a>
                                <a href="#" class="dropdown-item remove-account-btn text-danger" data-toggle="modal" data-target="#removeAccountModal" data-domainid="{{ domain.id }}" data-accountid="{{ account.id }}" data-username="{{ account.username }}"><i class="fa fa-trash fa-fw"></i> {{ _("Delete account") }}</a>
                            </div>
                        </div>
                    </td>
                    <td><a href="/account/{{ domain.id }}/{{ account.id }}/edit" title="{{ _("Edit account") }}">{{ account.username }}</a></td>
                    <td>{% if account.catchAll %}<span class="text-warning">{{ _("Catches all undefined email addresses for this domain.") }}</span><br>{% endif %}{{ account.addresses|join:"<br>" }}</td>
                    <td>{{ account.forwards|join:"<br>" }}{% if account.forwards.count > 0 %}<br><i class="fa fa-{% if account.keepLocal %}check-circle-o{% else %}times-circle-o{% endif %}"></i> {{ _("keep local copy") }}{% endif %}</td>
                    <td>
                        <div class="progress" title="{{ account.usagePercent }}%">
                            <div class="progress-bar bg-info pb-w-{{ account.usagePercentFlat }}" role="progressbar" aria-valuenow="{{ account.usage }}" aria-valuemin="0" aria-valuemax="{{ account.quota }}" title="{{ account.usagePercent|floatformat:2 }}">{{ account.usagePercent|floatformat:2 }}%</div>
                        </div>
                        <p class="text-right"><small>{{ account.humanUsage }}/{{ account.humanQuota }}</small></p>
                    </td>
                    <td>
                        <i class="fa {% if account.imap %}fa-check-square-o text-success{% else %}fa-square-o text-danger{% endif %} fa-fw"></i> IMAP<br />
                        <i class="fa {% if account.pop %}fa-check-square-o text-success{% else %}fa-square-o text-danger{% endif %} fa-fw"></i> POP<br />
                        <i class="fa {% if account.sieve %}fa-check-square-o text-success{% else %}fa-square-o text-danger{% endif %} fa-fw"></i> Sieve<br />
                        <i class="fa {% if account.smtpauth %}fa-check-square-o text-success{% else %}fa-square-o text-danger{% endif %} fa-fw"></i> SMTP-Auth<br />
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<div class="modal fade" id="checkAccountModal" tabindex="-1" role="dialog" aria-describedby="checkAccountLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="checkAccountLabel">{{ _("Check account") }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="{{ _("Close") }}">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h3 id="checkAccountName"></h3>
                <div id="checkAccountActive" class="text-center">
                    <i class="fa fa-circle-o-notch fa-5x fa-spin"></i>
                </div>
                <ul id="checkAccountList">
                </ul>
                <div class="container-fluid">
                    <div class="row">
                        <div id="check-account-message-container" class="col">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-times"></i> {{ _("Cancel") }}</button>
                <button type="button" id="checkAccountSubmit" class="btn btn-danger"><i id="checkAccountIcon" class="fa fa-stethoscope"></i> {{ _("Recheck") }}</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="removeAccountModal" tabindex="-1" role="dialog" aria-describedby="removeAccountLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="removeAccountLabel">{{ _("Delete account") }}</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="{{ _("Close") }}">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fa fa-warning fa-5x text-danger"></i>
                    <h3 id="removeAccountName"></h3>
                    <p class="text-warning">{{ _("Are you sure you want to delete this account?") }}</p>
                    <p>{{ _("To proceed, please enter the user name of the account you want to delete.") }}</p>
                    <form id="removeAccountForm">
                        <input type="text" id="accountName" name="accountName" class="form-control" placeholder="{{ _("Account name") }}" value="" required>
                    </form>
                </div>
                <div class="container-fluid">
                    <div class="row">
                        <div id="remove-account-message-container" class="col">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-times"></i> {{ _("Cancel") }}</button>
                <button type="submit" id="removeAccountSubmit" form="removeAccountForm" class="btn btn-danger"><i id="removeAccountIcon" class="fa fa-trash"></i> {{ _("Delete") }}</button>
            </div>
        </div>
    </div>
</div>

{% else %}

<div class="row mt-4 justify-content-center">
    <div class="col-12 col-sm-12 col-md-8 col-lg-6">
        <div class="card card-outline-primary text-center">
            <div class="card-block">
                <h2 class="card-title">{% i18n "No accounts for %1" domain.name %}</h2>
                <p class="card-text">{{ _("There are no user accounts for this domain. Add new email accounts by hitting the button below.") }}</p>
                <a href="/domain/{{ domain.id }}/add_account" class="btn btn-primary"><i class="fa fa-plus"></i> {{ _("Add Account") }}</a>
            </div>
        </div>
    </div>
</div>

{% endif %}
